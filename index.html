function doPost(e) {
  var p = e.parameter || {};
  var name    = (p.name || "").trim();
  var email   = (p.email || "").trim();
  var phone   = (p.phone || "").trim();
  var message = (p.message || "").trim();

  var OWNER_EMAIL = "info.halohisnik@gmail.com";

  // 1) Mail tebi
  MailApp.sendEmail({
    to: OWNER_EMAIL,
    replyTo: email || OWNER_EMAIL,
    subject: "Nova prijava ‚Äî Hi≈°nikNaKlik",
    htmlBody:
      "<b>Ime:</b> " + safe(name) + "<br>" +
      "<b>E-po≈°ta:</b> " + safe(email) + "<br>" +
      "<b>Telefon:</b> " + safe(phone) + "<br>" +
      "<b>Opis:</b><br>" + safe(message).replace(/\n/g, "<br>") + "<br><br>" +
      "<i>ƒåas:</i> " + Utilities.formatDate(new Date(), "Europe/Ljubljana", "dd.MM.yyyy HH:mm")
  });

  // 2) Auto-reply uporabniku
  if (email) {
    MailApp.sendEmail({
      to: email,
      subject: "Prejeli smo va≈°o prijavo ‚Äî Hi≈°nikNaKlik",
      htmlBody:
        "Pozdravljeni" + (name ? " " + safe(name) : "") + ",<br><br>" +
        "Hvala za prijavo! Va≈°e sporoƒçilo smo prejeli. " +
        "Oglasimo se vam v najkraj≈°em ƒçasu in se dogovorimo za termin ter okvirni stro≈°ek.<br><br>" +
        "<b>Va≈°e sporoƒçilo:</b><br>" + safe(message).replace(/\n/g, "<br>") + "<br><br>" +
        "Lep pozdrav,<br>Hi≈°nikNaKlik<br>" +
        "üìû 040 661 161 &nbsp;‚Ä¢&nbsp; ‚úâÔ∏è info.halohisnik@gmail.com"
    });
  }

  // CORS (da lahko kasneje odstrani≈° 'no-cors' v fetchu)
  return ContentService.createTextOutput(JSON.stringify({ok:true}))
    .setMimeType(ContentService.MimeType.JSON)
    .setHeader("Access-Control-Allow-Origin", "*")
    .setHeader("Access-Control-Allow-Methods", "POST, GET, OPTIONS")
    .setHeader("Access-Control-Allow-Headers", "Content-Type");
}

function doGet() {
  return ContentService.createTextOutput("OK")
    .setHeader("Access-Control-Allow-Origin", "*");
}

function safe(s){ return String(s).replace(/[<>&]/g, c => ({'<':'&lt;','>':'&gt;','&':'&amp;'}[c])); }

